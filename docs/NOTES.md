# Журнал проекта

20201119
- systemd сервис для Vector сконфигурирован для пользователя vector, при этом директория с чекпойнтами создалась для пользователя root; это приводило к ошибке записи чекпойнтов процессом. исправилось изменением systemd конфигураци; вопрос - как-то по-другому надо ставить Vector?
- Проблема: У нашего vast стоит duration 1 час, большой duration необходим, чтобы плеер не скипнул рекламу раньше времени. Можно уменьшить duration до 5 минут. Если поставить паузу то по истечению duration реклама скипнется раньше времени. 

20201118
- Проблема с autoplay видео на chrome (в firefox работает). Исправление потребуeт изменение билиотеки vast-player

20201116
- Мониторинг системы:
    - API не мониторим
    - Состояние NGINX. При проблемах могут теряться записи в логах -> потеря статистики.
    - Состояние Vector. При падениии лог-майнера логи перестанут попадать в Кликхаус - устаревшая статистика. После рестарта все допишется.
    - Состояние Clickhouse. При падении логи станут теряться, т.к. Вектор выполнит ретрай после ошибки 3 раза и пойдет дальше.
        - Самый неприятный случай, т.к. несмотря на наличие всех логов статистику придется догружать/перегружать руками.
        - Если после падения лог успел ротироваться, то надо будет настраивать Вектор на сканирование всех ротированных логов
            - М.б. стоит сразу задать маску на все ротированные файлы, чтобы автоматически восстанавливалось после рестарта?
    - Состояние Postgres. Приводит к ошибкам API, ничего не теряется, после рестарта все восстанавливается.

20201113
- Ограничения NGINX лог майнинга 
    - при количестве запросов/сек ~1000 требует конфигурации для буферизованной записи
    - при количестве запросов/сек >2000 упирается в пропускную способность диска 

20201106
- VAST4&OMID
    - [пример VAST 4 тега с OMID верификацией](https://github.com/julienpetit/iab-omid-verification-client/blob/master/vast/vast4.xml)
    - используется [проверочный скрипт от IAB](https://github.com/InteractiveAdvertisingBureau/Open-Measurement-JSClients/blob/master/src/validation-verification-script/validation-verification-client.js)
    - подписывается на события сессии и OMID функцией `VerificationClient.registerSessionObserver`
    - в обработчике события `sessionStart` в приходящем параметры доступен контекст `event.data.context`
    - если `context.accessMode === "full"`, то можно получить `HTMLVideoElement` в котором проигрывается креатив из поля `context.videoElement`

20201103
- Разбор примера
    - `this._adParameters = JSON.parse(i.AdParameters)` (bundle:3217) получает параметры из закодированного значения параметра в VAST
        - содержит значения:
            - `vastPacks` с данными исходного VAST
            - `endpoint` - ?
            - `code`
            - `minViews`
            - `impOn`
            - `playerVolume`
            - `vpaidVolume`
    - функция `preroll: "js:getPreroll"` возвращает ссылку на VAST (см. https://playerjs.com/docs/en=linkvast#js)
    - Используется Google IMA для загрузки VAST тега? (задается в `adsRequest.adTagUrl`)
        - не похоже, что вообще используется, хотя и загружается

20201102
- Ограничения на креативы враппера
    - во враппере можно добавлять только Companion креативы
    - Companion креативы показываются (опционально) плеером вне окна плеера, параллельно основному креативу
    - Companion креативы никак не связаны с VPAID (но вроде позволяют загрузку javascript креативов)
    - будут в первую очередь показаны Companion креативы ближашие к инлайну
    - в случае отсутствия Companion креативов в инлайне, может быть показан Companion креатив из враппера
- Как заставить javascript выполниться перед исходным VAST-тегом?
    - выполнить скрипт в StaticResource компаньона-креатива?
    - генерировать инлайн VPAID, который сможет программно вызывать VAST-тег после необходимых проверок?
    - (разобраться с реализацией предоставленного примера - возможно там реализация предыдущего пункта)

20201030
- Креатив VPAID обертки загружается после исходного VAST. Как можно изменить порядок?
